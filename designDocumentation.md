# galgame设计文档
---
## 总体目标
 完成一个完成度较高、可持续扩展更新的游戏。

## 功能介绍
* 游戏的主要玩法分为三类：galgame剧情模式，地图刷怪冒险模式，角色番外模式；  
> 剧情模式：在一章剧情内需要完成的有对话流程、选项分支、对剧情人物相关状态（信息展示程度、好感度）的影响、历史对话记录和关键词提示。  
>> 在整个模式的最外层需要记录有当前章节进度、已解锁剧情人物及相关信息查看。  

> 冒险模式：配有可拖拽式地图，在地图上有可交互的点显示地图的相关信息，点击跳转进入单机战斗模式。
>> 战斗模式需要同时考虑两种战斗流程和一个战斗结果、奖品。

> 番外模式：配有角色站姿和移动图和网格地图、相关素材贴图，角色可在地图内移动，在触碰特殊物体时发送信号，进入不同的事件中，可以做成类似魔塔的模式。  

* 游戏模式分为连接模式和离线模式，通过是否连接服务器获取云端数据进行区分，同时在线模式下进入同功能的另一个主界面——大厅界面。在离线模式下，仅能体验游戏的部分功能：剧情模式、冒险模式（固定战斗人物和默认卡组）、卡牌仓库可以对所有卡牌进行查看，但不能操作、有一个默认卡组但不能编辑和新增卡组。
* 需要有登入/退出接口，分别对应在线、离线模式状态，根据状态不同进入不同的主要界面，访问游戏的不同功能。
* 离线模式具有的功能接口：  
||新篇章||-（剧情、冒险、番外）仅能体验部分功能，如剧情只能体验第一章，冒险只能参与对战测试。  
||设置||- 调整游戏文本加载速度、声音大小、字体大小、进行主题皮肤更换。  
||卡牌仓库（临时）||-仅能对卡牌进行查看、查找功能。  
||玩家状态||
* 在线模式具有的功能接口：  
||新篇章||  
||设置||  
||抽卡||  
||卡牌仓库||  
||聊天窗口||  
||玩家状态||  
||背包||   
||排行榜||  
||集市||  
---
## 游戏系统
* 卡牌系统：[记录卡牌属性]
> 卡牌属性-ID、卡牌主类、卡牌副类、ATK、DEF、DHP、IMAGE、BATTLE_STAND、BATTLE_ATK、BATTLE_DIE、BATTLE_VECTORY  
> 卡框-（用于区分人物卡和道具装备）  
> 卡面-卡牌详细页面。   
> 卡牌查询-寻找、卡牌详细页面展开    
> 卡牌管理-卡牌升阶（人物卡）、卡牌互动（人物卡）、卡牌返尘（道具装备）。  
> 卡牌构建-构建队列设置、选择构筑师（人物卡-关键词对应效果）。  
> 卡牌图鉴  
> 卡组管理-（查看-显示囊括卡牌）-默认卡组-（构筑-选择核心人物-（查看服务器内卡组池子/自己选择卡牌）添加卡牌（若有则添加成功、若无则忽略）-命名-是否上传）。

* 关卡系统
> 所有类别的关卡具有同一套ID、类别、封面图、推荐等级  
> 根据类别特化
> 剧情人物-专属于剧情模式的一类数据、仅有介绍和好感度
> CG回顾（尘缘书简）
> 成就展览（刻碑塔）

* 抽卡系统
> 卡池更新、配置、概率展示  
> 抽取卡牌、氪金界面

* 背包
> 展示道具信息、选择使用

* 排行榜
> 展示玩家氪金信息、通关信息、卡牌搜集度信息

* 聊天
> 聊天分栏：世界、私聊  
> 对私聊模式添加一个可扩展输入框，输入对方id/userName即可。  
> 关键词检测系统-初始化-更新（通过服务器更新）  
> 规定字符串长度不超过20字。

* 集市
> 市场更新-从服务器数据库中读取信息到本地数据库中，然后进行展示。  
> 查找/筛选功能。  
> 购入道具  
> 摆摊


---
## 设计规范
* 数据库设计：   

        属性名采用驼峰命名法  
        ID相关使用int  
        数值相关使用int  
        坐标使用int  
        Name相关使用varchar(20)  
        Category相关使用varchar(10)  
        Rarity相关使用varchar(6)  
        描述相关使用text  
        对话文本使用text  
        序列类使用text，并用|分割。

* QT端代码设计

## 层次结构及功能
#### 采用数据层--业务层--用户层三层架构方式，对每个层级进行模块化分割。
* 数据层  
用于处理数据相关内容，包括对数据的结构定义、存读更新、提供的接口。  

         卡牌数据：工厂模式实例化、组建模式装配。
         用户获取卡牌信息、初始化卡牌信息、更新卡牌信息、删除卡牌
         
相关类：

        Card:
        Base：ID、名称、稀有度、描述、卡面图片。
        Bridge：QMap装配模块，反射确定模块类名。
        CharacterCard：装配love、battle、gesture、story模块。
        CommentCard：装配battle模块。

        Model:
        Base：gradeTabel、keyValue、enumName、setValues（enumName，QList<QString>）。  
        LoveModel：lines1、lines2、lines3、gradeTable、value。  
        BattleModel：ATK、DEF、DHP、growthATK、growthDEF、growthDHP、gradeTable、value。  
        GestureModel：QList<>stand、QList<>ATK、QList<>DEF、QList<>Win、QList<>lose、gradeTable、value。  
        StoryModel：QList<>comment、QList<>happy、QList<>shy、QList<>angry、QList<>amazed、gradeTable、value。



